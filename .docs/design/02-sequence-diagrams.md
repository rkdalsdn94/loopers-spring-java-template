# μ‹ν€€μ¤ λ‹¤μ΄μ–΄κ·Έλ¨ (Sequence Diagrams)

> κ° κΈ°λ¥μ΄ **μ–΄λ–»κ² λ™μ‘ν•λ”μ§€**, **λ„κ°€ λ¬΄μ—‡μ„ μ±…μ„μ§€λ”μ§€**λ¥Ό μ‹κ°ν™”ν• λ¬Έμ„μ…λ‹λ‹¤.

---

## π“ λ¬Έμ„μ λ©μ 

### μ΄ λ¬Έμ„λ” μ™ ν•„μ”ν•κ°€?

μ½”λ“λ¥Ό μ‘μ„±ν•κΈ° μ „μ— `"λ„κ°€ λ¬΄μ—‡μ„ ν•΄μ•Ό ν•λ”κ°€"`λ¥Ό λ¨Όμ € μ •λ¦¬ν•μ§€ μ•μΌλ©΄ λ‹¤μκ³Ό κ°™μ€ λ¬Έμ κ°€ λ°μƒν•  μ μλ‹¤κ³  μƒκ°ν•©λ‹λ‹¤.
- ν• ν΄λμ¤μ— λ¨λ“  λ΅μ§μ΄ μ§‘μ¤‘λ¨ (μ±…μ„ κ³Όμ¤‘)
- κ°μ²΄ κ°„ ν‘λ ¥ κµ¬μ΅°κ°€ λ³µμ΅ν•΄μ§
- λ³€κ²½μ΄ μ–΄λ ¤μ›μ§ (ν• κ³³μ„ κ³ μΉλ©΄ μ—¬λ¬ κ³³μ΄ κΉ¨μ§)

μ‹ν€€μ¤ λ‹¤μ΄μ–΄κ·Έλ¨μ€ **μ½”λ“λ³΄λ‹¤ λΉ λ¥΄κ²** μ„¤κ³„λ¥Ό κ³µμ ν•κ³  κ²€ν† ν•  μ μλ” λ„κµ¬λΌκ³  μƒκ°ν•©λ‹λ‹¤.

## π­ λ“±μ¥μΈλ¬Ό (μ°Έμ—¬μ)

### κ° μ°Έμ—¬μμ μ—­ν• 

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚   κ³ κ°       β”‚  β†’ μ‹¤μ  μ„λΉ„μ¤λ¥Ό μ‚¬μ©ν•λ” μ‚¬λ (μ•΅ν„°)
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”

β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ Controller  β”‚  β†’ HTTP μ”μ²­μ„ λ°›μ•„μ„ μ μ ν• μ„λΉ„μ¤λ΅ μ „λ‹¬
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β†’ "λ„κ°€ μ΄ κΈ°λ¥μ„ μ²λ¦¬ν•μ§€?"λ¥Ό κ²°μ •

β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚   Facade    β”‚  β†’ μ—¬λ¬ λ„λ©”μΈμ„ μ΅°μ¨ν•λ” μ§€νμ
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β†’ "Aλ„ ν•κ³ , Bλ„ ν•κ³ , Cλ„ ν•΄!"

β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚  Service    β”‚  β†’ λ‹¨μΌ λ„λ©”μΈμ λΉ„μ¦λ‹μ¤ λ΅μ§ μ‹¤ν–‰
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β†’ "λ‚΄ μμ—­μ—μ„λ” μ΄λ ‡κ² μ²λ¦¬ν•΄!"

β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚  Domain     β”‚  β†’ λΉ„μ¦λ‹μ¤ κ·μΉ™μ„ λ‹΄μ€ ν•µμ‹¬ κ°μ²΄
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β†’ "λ‚λ” μ΄ κ·μΉ™μ— λ”°λΌ μ›€μ§μ—¬!"

β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ Repository  β”‚  β†’ λ°μ΄ν„°λ² μ΄μ¤μ™€ ν†µμ‹ 
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β†’ "λ°μ΄ν„°λ¥Ό μ €μ¥ν•κ³  λ¶λ¬μ¬κ²!"
```

## π― ν•µμ‹¬ μ‹ν€€μ¤ λ‹¤μ΄μ–΄κ·Έλ¨

---

## 1. μ£Όλ¬Έ μƒμ„± (Order Creation)

### π’­ ν•΄κ²°ν•λ ¤λ” λ¬Έμ 

**μƒν™©**
```
κ³ κ°: "μƒν’ 3κ° μ£Όλ¬Έν• κ²μ”!"

μ‹μ¤ν…μ΄ ν•΄μ•Ό ν•  μΌ:
1. μ¬κ³ κ°€ μ¶©λ¶„ν•μ§€ ν™•μΈ
2. μ¬κ³  μ°¨κ°
3. ν¬μΈνΈκ°€ μ¶©λ¶„ν•μ§€ ν™•μΈ
4. ν¬μΈνΈ μ°¨κ°
5. μ£Όλ¬Έ μƒμ„±

λ§μ•½ μ¤‘κ°„μ— ν•λ‚λΌλ„ μ‹¤ν¨ν•λ©΄?
β†’ μ΄μ „ λ‹¨κ³„λ„ λ¨λ‘ μ·¨μ†ν•΄μ•Ό ν•¨!
```

**μ–΄λ ¤μ΄ μ΄μ **
- μ—¬λ¬ λ„λ©”μΈ(μƒν’, ν¬μΈνΈ, μ£Όλ¬Έ)μ΄ ν‘λ ¥ν•΄μ•Ό ν•¨
- ν•λ‚λΌλ„ μ‹¤ν¨ν•λ©΄ μ „μ²΄κ°€ μ·¨μ†λμ–΄μ•Ό ν•¨ (μ›μμ„±)
- κ° λ„λ©”μΈμ μ±…μ„μ„ λ…ν™•ν λ¶„λ¦¬ν•΄μ•Ό ν•¨

### π¬ μ‹¤ν–‰ νλ¦„

```mermaid
sequenceDiagram
    actor κ³ κ°
    participant Controller as OrderController<br/>(μ”μ²­ μ ‘μ)
    participant Facade as OrderFacade<br/>(μ§€νμ)
    participant ProductService as ProductService<br/>(μ¬κ³  κ΄€λ¦¬μ)
    participant PointService as PointService<br/>(ν¬μΈνΈ κ΄€λ¦¬μ)
    participant OrderService as OrderService<br/>(μ£Όλ¬Έ μƒμ„±μ)
    participant DB as Database

    Note over κ³ κ°: μƒν’ A 2κ°, μƒν’ B 1κ°<br/>μ΄ 50,000μ› μ£Όλ¬Έ

    κ³ κ°->>Controller: μ£Όλ¬Έ μ”μ²­
    Note over Controller: "λ„κ°€ μ£Όλ¬Έμ„ μ²λ¦¬ν•μ§€?"<br/>β†’ OrderFacadeκ°€ μ²λ¦¬!

    Controller->>Facade: createOrder(κ³ κ°ID, μƒν’λ©λ΅)
    
    Note over Facade,DB: === νΈλμ­μ… μ‹μ‘ ===<br/>λ¨λ‘ μ„±κ³µ or λ¨λ‘ μ‹¤ν¨

    Note over Facade: "λ¨Όμ € μ¬κ³ λ¶€ν„° ν™•μΈν•μ"
    Facade->>ProductService: μƒν’ A μ¬κ³  ν™•μΈ λ° μ°¨κ°
    
    alt μ¬κ³  λ¶€μ΅±
        ProductService-->>Facade: β μ¬κ³  λ¶€μ΅±!
        Facade-->>Controller: μ£Όλ¬Έ μ‹¤ν¨
        Controller-->>κ³ κ°: "μƒν’ Aμ μ¬κ³ κ°€ λ¶€μ΅±ν•©λ‹λ‹¤"
        Note over κ³ κ°: μ£Όλ¬Έ λ¶κ°€, μ¬κ³  λ³€ν™” μ—†μ
    else μ¬κ³  μ¶©λ¶„
        ProductService->>DB: μ¬κ³  μ°¨κ° (10κ° β†’ 8κ°)
        
        Note over Facade: "μ¬κ³  OK! μ΄μ  ν¬μΈνΈ ν™•μΈ"
        Facade->>PointService: ν¬μΈνΈ 50,000μ› μ°¨κ°
        
        alt ν¬μΈνΈ λ¶€μ΅±
            PointService-->>Facade: β ν¬μΈνΈ λ¶€μ΅±!
            Note over DB: νΈλμ­μ… λ΅¤λ°±!<br/>μ¬κ³ λ„ μ›λ³µλ¨ (8κ° β†’ 10κ°)
            Facade-->>Controller: μ£Όλ¬Έ μ‹¤ν¨
            Controller-->>κ³ κ°: "ν¬μΈνΈκ°€ λ¶€μ΅±ν•©λ‹λ‹¤"
        else ν¬μΈνΈ μ¶©λ¶„
            PointService->>DB: ν¬μΈνΈ μ°¨κ°<br/>ν¬μΈνΈ κ±°λ λ‚΄μ—­ κΈ°λ΅
            
            Note over Facade: "μ¬κ³  OK, ν¬μΈνΈ OK!<br/>μ΄μ  μ£Όλ¬Έ μƒμ„±"
            Facade->>OrderService: μ£Όλ¬Έ μƒμ„±
            OrderService->>DB: μ£Όλ¬Έ μ €μ¥
            
            Note over Facade,DB: === νΈλμ­μ… μ»¤λ°‹ ===<br/>λ¨λ“  λ³€κ²½μ‚¬ν•­ ν™•μ •!
            
            OrderService-->>Facade: β… μ£Όλ¬Έ #123 μƒμ„±
            Facade-->>Controller: μ£Όλ¬Έ μ„±κ³µ
            Controller-->>κ³ κ°: "μ£Όλ¬Έμ΄ μ™„λ£λμ—μµλ‹λ‹¤<br/>μ£Όλ¬Έλ²νΈ: #123"
        end
    end
```

### π’΅ ν•µμ‹¬ ν¬μΈνΈ

**1. μ±…μ„ λ¶„λ¦¬ (Separation of Concerns)**

```
OrderFacade (μ§€νμ):
"λ‚λ” μ „μ²΄ νλ¦„λ§ μ΅°μ¨ν• κ²"
- μ¬κ³  μ²λ¦¬λ” ProductServiceμ—κ²
- ν¬μΈνΈ μ²λ¦¬λ” PointServiceμ—κ²
- μ£Όλ¬Έ μƒμ„±μ€ OrderServiceμ—κ²

κ° Service (μ „λ¬Έκ°€):
"λ‚΄ λ¶„μ•Όλ” λ‚΄κ°€ μ μΌ μ μ•μ•„"
- ProductService: μ¬κ³  κ΄€λ¦¬ μ „λ¬Έκ°€
- PointService: ν¬μΈνΈ κ΄€λ¦¬ μ „λ¬Έκ°€
- OrderService: μ£Όλ¬Έ μƒμ„± μ „λ¬Έκ°€
```

**2. νΈλμ­μ… (All or Nothing)**

```
[μ„±κ³µ μ‹]
μ¬κ³  μ°¨κ° β…
ν¬μΈνΈ μ°¨κ° β…  
μ£Όλ¬Έ μƒμ„± β…
β†’ λ¨λ‘ ν™•μ •!

[μ‹¤ν¨ μ‹]
μ¬κ³  μ°¨κ° β…
ν¬μΈνΈ μ°¨κ° β
β†’ μ¬κ³  μ°¨κ°λ„ μ·¨μ†!
β†’ μ²μ μƒνƒλ΅ λλμ•„κ°
```

**3. μ™ μ΄λ ‡κ² μ„¤κ³„ν–λ‚?**

```
Q: μ™ Facadeκ°€ ν•„μ”ν•κ°€μ”? Serviceκ°€ μ§μ ‘ ν•λ©΄ μ• λλ‚μ”?

A: κ° Serviceλ” μκΈ° λ¶„μ•Όλ§ μ§‘μ¤‘ν•΄μ•Ό ν•©λ‹λ‹¤.
   - ProductServiceλ” ν¬μΈνΈλ¥Ό λ°λΌλ„ λ¨
   - PointServiceλ” μ¬κ³ λ¥Ό λ°λΌλ„ λ¨
   - λ‘μ„ μ΅°μ¨ν•λ” κ±΄ Facadeμ μ—­ν• !

Q: νΈλμ­μ…μ€ μ–΄λ””μ„ μ‹μ‘ν•λ‚μ”?

A: Facadeμ—μ„ μ‹μ‘ν•©λ‹λ‹¤.
   - @Transactional μ–΄λ…Έν…μ΄μ… μ‚¬μ©
   - Facade λ©”μ„λ“κ°€ λλ‚λ©΄ μ»¤λ°‹/λ΅¤λ°± κ²°μ •
```

---

## 2. μƒν’ μΆ‹μ•„μ” λ“±λ΅ (Product Like)

### π’­ ν•΄κ²°ν•λ ¤λ” λ¬Έμ 

**μƒν™©**
```
κ³ κ°: "μ΄ μƒν’ λ§μμ— λ“¤μ–΄! μΆ‹μ•„μ” λ„λ¥΄μ"
(ν΄λ¦­)
κ³ κ°: "μ•„, μ‹¤μλ΅ λ λλ €λ„¤"
(ν΄λ¦­)

μ‹μ¤ν…μ€ μ–΄λ–»κ² λ°μ‘ν•΄μ•Ό ν• κΉ?
β†’ μ¤‘λ³µ μΆ‹μ•„μ”λ΅ μ—λ¬λ¥Ό λ‚΄λ©΄ κ³ κ°μ΄ λ‹Ήν™©ν•¨
β†’ λ©±λ“±ν•κ² μ²λ¦¬ν•΄μ•Ό ν•¨ (μ—¬λ¬ λ² λλ¬λ„ ν• λ²λ§ λ“±λ΅)
```

### π¬ μ‹¤ν–‰ νλ¦„

```mermaid
sequenceDiagram
    actor κ³ κ°
    participant Controller as LikeController<br/>(μ”μ²­ μ ‘μ)
    participant Service as LikeService<br/>(μΆ‹μ•„μ” κ΄€λ¦¬μ)
    participant DB as Database

    κ³ κ°->>Controller: μƒν’ #5 μΆ‹μ•„μ”!
    Controller->>Service: addLike(κ³ κ°ID, μƒν’ID=5)
    
    Service->>DB: μ΄λ―Έ μΆ‹μ•„μ”ν–λ”μ§€ ν™•μΈ
    
    alt μ΄λ―Έ μΆ‹μ•„μ”ν•¨
        DB-->>Service: μΆ‹μ•„μ” μ΅΄μ¬ν•¨
        Service-->>Controller: β… μΆ‹μ•„μ” μ™„λ£ (κΈ°μ΅΄ μ μ§€)
        Controller-->>κ³ κ°: "μΆ‹μ•„μ”!"
        Note over κ³ κ°: μ—λ¬ μ—†μ΄ μ„±κ³µ<br/>(λ©±λ“±μ„±)
    else μΆ‹μ•„μ” μ• ν•¨
        DB-->>Service: μΆ‹μ•„μ” μ—†μ
        Service->>DB: μΆ‹μ•„μ” μ €μ¥
        Service->>DB: μΆ‹μ•„μ” μ +1
        Service-->>Controller: β… μΆ‹μ•„μ” μ™„λ£ (μƒλ΅ λ“±λ΅)
        Controller-->>κ³ κ°: "μΆ‹μ•„μ”!"
    end
```

### π’΅ ν•µμ‹¬ ν¬μΈνΈ

**1. λ©±λ“±μ„± (Idempotency)**

```
λ©±λ“±ν•λ‹¤ = μ—¬λ¬ λ² μ‹¤ν–‰ν•΄λ„ κ²°κ³Όκ°€ κ°™λ‹¤

[λ‚μ μ]
1λ² ν΄λ¦­: μΆ‹μ•„μ” 1κ°
2λ² ν΄λ¦­: μ—λ¬! "μ΄λ―Έ μΆ‹μ•„μ”ν–μµλ‹λ‹¤"
β†’ κ³ κ° νΌλ€

[μΆ‹μ€ μ]
1λ² ν΄λ¦­: μΆ‹μ•„μ” 1κ°
2λ² ν΄λ¦­: μΆ‹μ•„μ” 1κ° (κ·Έλ€λ΅)
β†’ κ³ κ° λ§μ΅±
```

**2. μ™ μ΄λ ‡κ² μ„¤κ³„ν–λ‚?**

```
Q: μ¤‘λ³µ μΆ‹μ•„μ” μ‹λ„λ¥Ό μ—λ¬λ΅ μ²λ¦¬ν•λ©΄ μ• λλ‚μ”?

A: μ‚¬μ©μ κ²½ν—μ΄ λ‚λΉ μ§‘λ‹λ‹¤.
   - λ„¤νΈμ›ν¬ μ§€μ—°μΌλ΅ κ°™μ€ μ”μ²­μ΄ μ—¬λ¬ λ² κ° μ μμ
   - κ³ κ°μ΄ μ‹¤μλ΅ μ—¬λ¬ λ² ν΄λ¦­ν•  μ μμ
   - "μ΄λ―Έ μΆ‹μ•„μ”ν•¨"λ„ κ²°κµ­ "μΆ‹μ•„μ” μƒνƒ"μ΄λ―€λ΅ μ„±κ³µ!

Q: μΆ‹μ•„μ” μλ” μ–΄λ–»κ² κ΄€λ¦¬ν•λ‚μ”?

A: λ‘ κ°€μ§€ λ°©λ²•μ΄ μμµλ‹λ‹¤.
   1. likes ν…μ΄λΈ”μ—μ„ COUNT(*) μ‹¤μ‹κ°„ κ³„μ‚°
   2. products ν…μ΄λΈ”μ— like_count μ»¬λΌ κ΄€λ¦¬
   β†’ μ„±λ¥μ„ μ„ν•΄ λ³΄ν†µ 2λ² μ„ νƒ
```

---

## 3. μƒν’ μΆ‹μ•„μ” μ·¨μ† (Product Unlike)

### π’­ ν•΄κ²°ν•λ ¤λ” λ¬Έμ 

```
κ³ κ°: "μ΄ μƒν’ λ³„λ΅λ„¤, μΆ‹μ•„μ” μ·¨μ†ν•μ"
(ν΄λ¦­)
κ³ κ°: "μ–΄? λ λλ €λ„¤"
(ν΄λ¦­)

λ“±λ΅κ³Ό λ§μ°¬κ°€μ§€λ΅ μ·¨μ†λ„ λ©±λ“±ν•΄μ•Ό ν•¨!
```

### π¬ μ‹¤ν–‰ νλ¦„

```mermaid
sequenceDiagram
    actor κ³ κ°
    participant Controller as LikeController
    participant Service as LikeService
    participant DB as Database

    κ³ κ°->>Controller: μƒν’ #5 μΆ‹μ•„μ” μ·¨μ†!
    Controller->>Service: removeLike(κ³ κ°ID, μƒν’ID=5)
    
    Service->>DB: μΆ‹μ•„μ” μ‚­μ  μ‹λ„
    
    alt μΆ‹μ•„μ” μμ—μ
        DB-->>Service: 1κ° μ‚­μ λ¨
        Service->>DB: μΆ‹μ•„μ” μ -1
        Service-->>Controller: β… μ·¨μ† μ™„λ£
        Controller-->>κ³ κ°: "μΆ‹μ•„μ” μ·¨μ†λ¨"
    else μ΄λ―Έ μ·¨μ†λ¨
        DB-->>Service: 0κ° μ‚­μ λ¨ (μ΄λ―Έ μ—†μ)
        Service-->>Controller: β… μ·¨μ† μ™„λ£
        Controller-->>κ³ κ°: "μΆ‹μ•„μ” μ·¨μ†λ¨"
        Note over κ³ κ°: μ—λ¬ μ—†μ΄ μ„±κ³µ<br/>(λ©±λ“±μ„±)
    end
```

### π’΅ ν•µμ‹¬ ν¬μΈνΈ

**μµμΆ… μƒνƒκ°€ μ¤‘μ”ν•λ‹¤**

```
λ©ν‘: "μΆ‹μ•„μ” μ—†μ" μƒνƒ λ§λ“¤κΈ°

[μΌ€μ΄μ¤ 1]
μΆ‹μ•„μ” μμ β†’ μ·¨μ† β†’ μΆ‹μ•„μ” μ—†μ β…

[μΌ€μ΄μ¤ 2]
μΆ‹μ•„μ” μ—†μ β†’ μ·¨μ† β†’ μΆ‹μ•„μ” μ—†μ β…

λ‘ λ‹¤ κ²°κ³Όλ” "μΆ‹μ•„μ” μ—†μ"μ΄λ―€λ΅ μ„±κ³µ!
```

---

## 4. μ£Όλ¬Έ μ·¨μ† (Order Cancellation)

### π’­ ν•΄κ²°ν•λ ¤λ” λ¬Έμ 

**μƒν™©**
```
[μ£Όλ¬Έ μƒμ„± μ‹ ν–λ μΌ]
1. μ¬κ³  μ°¨κ° (10κ° β†’ 8κ°)
2. ν¬μΈνΈ μ°¨κ° (100,000μ› β†’ 50,000μ›)
3. μ£Όλ¬Έ μƒμ„± (μ£Όλ¬Έ #123)

[μ·¨μ† μ‹ ν•΄μ•Ό ν•  μΌ]
β†’ μ„μ—μ„ ν• μΌμ„ λ¨λ‘ μ›λλ€λ΅!
1. ν¬μΈνΈ ν™λ¶ (50,000μ› β†’ 100,000μ›)
2. μ¬κ³  λ³µκµ¬ (8κ° β†’ 10κ°)
3. μ£Όλ¬Έ μƒνƒ λ³€κ²½ (λ€κΈ° β†’ μ·¨μ†)
```

### π¬ μ‹¤ν–‰ νλ¦„

```mermaid
sequenceDiagram
    actor κ³ κ°
    participant Controller as OrderController
    participant Facade as OrderFacade<br/>(μ§€νμ)
    participant OrderService as OrderService
    participant PointService as PointService
    participant ProductService as ProductService
    participant DB as Database

    κ³ κ°->>Controller: μ£Όλ¬Έ #123 μ·¨μ†!
    Controller->>Facade: cancelOrder(μ£Όλ¬ΈID=123)
    
    Facade->>OrderService: μ£Όλ¬Έ μ΅°ν
    OrderService->>DB: μ£Όλ¬Έ #123 μ΅°ν
    
    alt λ°°μ†΅ μ‹μ‘λ¨ (COMPLETED)
        OrderService-->>Facade: β μ£Όλ¬Έ μƒνƒ = μ™„λ£
        Facade-->>Controller: μ·¨μ† λ¶κ°€
        Controller-->>κ³ κ°: "λ°°μ†΅ μ‹μ‘ ν›„μ—λ”<br/>μ·¨μ†ν•  μ μ—†μµλ‹λ‹¤"
    else λ€κΈ° μ¤‘ (PENDING)
        Note over Facade,DB: === λ³΄μƒ νΈλμ­μ… μ‹μ‘ ===
        
        Note over Facade: μ—­μμΌλ΅ λ³µκµ¬!
        
        Facade->>PointService: ν¬μΈνΈ 50,000μ› ν™λ¶
        PointService->>DB: ν¬μΈνΈ λ³µκµ¬<br/>κ±°λ λ‚΄μ—­ κΈ°λ΅ (REFUND)
        
        Facade->>ProductService: μ¬κ³  2κ° λ³µκµ¬
        ProductService->>DB: μ¬κ³  λ³µκµ¬ (8κ° β†’ 10κ°)
        
        Facade->>OrderService: μ£Όλ¬Έ μƒνƒ λ³€κ²½
        OrderService->>DB: μƒνƒ = μ·¨μ†
        
        Note over Facade,DB: === νΈλμ­μ… μ»¤λ°‹ ===
        
        OrderService-->>Facade: β… μ·¨μ† μ™„λ£
        Facade-->>Controller: μ·¨μ† μ„±κ³µ
        Controller-->>κ³ κ°: "μ£Όλ¬Έμ΄ μ·¨μ†λμ—μµλ‹λ‹¤<br/>ν¬μΈνΈκ°€ ν™λ¶λμ—μµλ‹λ‹¤"
    end
```

### π’΅ ν•µμ‹¬ ν¬μΈνΈ

**λ³΄μƒ νΈλμ­μ… (Compensating Transaction)**

```
[μƒμ„± μ‹ μμ„]
Step 1: μ¬κ³  μ°¨κ°
Step 2: ν¬μΈνΈ μ°¨κ°
Step 3: μ£Όλ¬Έ μƒμ„±

[μ·¨μ† μ‹ μμ„ (μ—­μ)]
Step 1: ν¬μΈνΈ ν™λ¶
Step 2: μ¬κ³  λ³µκµ¬
Step 3: μ£Όλ¬Έ μƒνƒ λ³€κ²½

μ™ μ—­μ?
β†’ μμ΅΄μ„± λ•λ¬Έ!
β†’ μ£Όλ¬Έμ΄ μμ–΄μ•Ό ν¬μΈνΈ/μ¬κ³ λ¥Ό λ³µκµ¬ν•  μ μμ
```

---

## 5. μƒν’ λ©λ΅ μ΅°ν (Product List)

### π’­ ν•΄κ²°ν•λ ¤λ” λ¬Έμ 

**μƒν™©**
```
μƒν’μ΄ 10,000κ° μλ”λ° ν• λ²μ— λ‹¤ μ΅°νν•λ©΄?
β†’ λ„λ¬΄ λλ¦Ό
β†’ λ©”λ¨λ¦¬ λ¶€μ΅±
β†’ ν™”λ©΄μ— λ‹¤ ν‘μ‹ν•  μλ„ μ—†μ

ν•΄κ²°: νμ΄μ§€λ„¤μ΄μ…
β†’ ν• λ²μ— 20κ°μ”©λ§ μ΅°ν
β†’ ν•„μ”ν• λ§νΌλ§ κ°€μ Έμ΄
```

### π¬ μ‹¤ν–‰ νλ¦„

```mermaid
sequenceDiagram
    actor κ³ κ°
    participant Controller as ProductController
    participant Service as ProductService
    participant DB as Database

    Note over κ³ κ°: A λΈλλ“ μƒν’<br/>κ°€κ²© λ‚®μ€ μ<br/>1νμ΄μ§€ (20κ°)

    κ³ κ°->>Controller: μƒν’ λ©λ΅ μ”μ²­
    Controller->>Service: getProducts(λΈλλ“=A, νμ΄μ§€=1, μ •λ ¬=κ°€κ²©β†‘)
    
    Service->>DB: SELECT * FROM products<br/>WHERE brand = 'A'<br/>ORDER BY price ASC<br/>LIMIT 20 OFFSET 0
    DB-->>Service: μƒν’ 20κ°
    
    Service->>DB: SELECT COUNT(*)<br/>WHERE brand = 'A'
    DB-->>Service: μ΄ 156κ°
    
    Service-->>Controller: 20κ° μƒν’ + μ΄ 156κ° μ •λ³΄
    Controller-->>κ³ κ°: μƒν’ λ©λ΅ ν‘μ‹<br/>(1/8 νμ΄μ§€)
```

### π’΅ ν•µμ‹¬ ν¬μΈνΈ

**νμ΄μ§€λ„¤μ΄μ… = μ„±λ¥ μµμ ν™”**

```
[λ‚μ μ]
SELECT * FROM products
β†’ products ν…μ΄λΈ” μ „λ¶€ μ΅°ν
β†’ 5μ΄ κ±Έλ¦Ό

[μΆ‹μ€ μ]
SELECT * FROM products LIMIT 20 OFFSET 0
β†’ 20κ°λ§ μ΅°ν
β†’ 0.1μ΄
```
