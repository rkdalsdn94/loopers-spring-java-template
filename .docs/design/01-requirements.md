# 요구사항 명세서 (Requirements Specification)

> 사용자의 니즈를 기능 명세로 전환하고, 모든 협업자가 동일한 언어로 소통하기 위한 문서입니다.

---

## 📚 유비쿼터스 언어 (공통 용어 정의)

> **모든 협업자가 같은 단어로 같은 개념을 이해하기 위한 용어 사전입니다.**

### 이커머스 도메인 용어

| 한글 | 영문 | 설명 | 예시 |
|---|---|---|---|
| **고객** | Customer / User | 우리 서비스를 사용하는 사람 | "고객이 로그인한다" |
| **상품** | Product | 판매하는 물건 | "나이키 에어맥스 270" |
| **브랜드** | Brand | 상품을 만드는 회사 | "나이키", "아디다스" |
| **좋아요** | Like | 관심 상품 표시 | "고객이 상품에 좋아요를 누른다" |
| **주문** | Order | 상품을 구매하는 행위 | "총 3개 상품을 주문했다" |
| **주문 항목** | Order Item | 주문에 포함된 개별 상품 정보 | "주문에 신발 2개, 티셔츠 1개 포함" |
| **재고** | Stock | 판매 가능한 상품 수량 | "재고가 10개 남았다" |
| **포인트** | Point | 고객이 보유한 결제 수단 | "보유 포인트 5,000원" |
| **포인트 충전** | Charge | 포인트를 증가시키는 행위 | "10,000원 충전했다" |
| **포인트 사용** | Use | 주문 시 포인트를 차감하는 행위 | "5,000원 사용했다" |
| **포인트 환불** | Refund | 주문 취소 시 포인트를 돌려주는 행위 | "취소해서 5,000원 환불받았다" |
| **주문 상태** | Order Status | 주문의 현재 상태 | "대기", "완료", "취소" |

### 주문 상태 정의

| 상태 | 의미 | 고객에게 보이는 문구 | 다음 가능한 상태 |
|---|---|---|---|
| **대기** (PENDING) | 주문이 생성되었으나 아직 처리 중 | "주문이 접수되었습니다" | 완료, 취소 |
| **완료** (COMPLETED) | 배송이 시작됨 | "배송 중입니다" | - |
| **취소** (CANCELED) | 고객이 주문을 취소함 | "주문이 취소되었습니다" | - |

### 포인트 거래 유형 정의

| 유형 | 의미 | 예시 |
|---|---|---|
| **충전** (CHARGE) | 포인트를 추가로 받음 | "+10,000원 충전" |
| **사용** (USE) | 주문 시 포인트 차감 | "-5,000원 사용 (주문 #123)" |
| **환불** (REFUND) | 주문 취소 시 포인트 복구 | "+5,000원 환불 (주문 #123 취소)" |

---

## 👤 사용자 스토리 (User Story)

> **고객의 입장에서 "누가, 무엇을, 왜" 하는지 정의합니다.**

### 스토리 작성 형식

```
애자일 사용자 스토리 템플릿

As a [역할]
I want [기능]
So that [이유/가치]

인수 조건
- [구체적인 성공 조건 1]
- [구체적인 성공 조건 2]
```

---

## 1. 상품 도메인

### US-P01: 상품 목록 조회

```
As a 고객
I want 상품 목록을 페이지로 나눠서 보고 싶다
So that 모든 상품을 로딩하지 않고 빠르게 탐색할 수 있다

인수 조건:
✓ 한 페이지에 20개씩 표시된다
✓ 브랜드를 선택하면 해당 브랜드 상품만 보인다
✓ 가격 낮은 순, 높은 순으로 정렬할 수 있다
✓ 최신 등록순으로 정렬할 수 있다
✓ 각 상품의 이름, 가격, 재고 여부를 확인할 수 있다

예외 상황:
- 해당 브랜드에 상품이 없으면 빈 목록을 반환한다
- 잘못된 페이지 번호는 첫 페이지를 보여준다
```

### US-P02: 상품 상세 조회

```
As a 고객
I want 상품의 상세 정보를 보고 싶다
So that 구매 결정을 내릴 수 있다

인수 조건:
✓ 상품명, 가격, 재고 수량, 상세 설명이 표시된다
✓ 소속 브랜드 정보도 함께 보인다
✓ 재고가 0개면 "품절"로 표시된다
✓ 현재 재고 수량이 실시간으로 반영된다

예외 상황:
- 존재하지 않는 상품이면 "상품을 찾을 수 없습니다" 표시
- 삭제된 상품이면 "판매 종료된 상품입니다" 표시
```

### US-P03: 상품 등록 (관리자)

```
As a 브랜드 관리자
I want 새로운 상품을 등록하고 싶다
So that 고객에게 신상품을 판매할 수 있다

인수 조건:
✓ 브랜드를 선택할 수 있다 (필수)
✓ 상품명을 입력한다 (필수)
✓ 가격을 입력한다 (0원 이상, 필수)
✓ 재고 수량을 입력한다 (0개 이상, 필수)
✓ 상세 설명을 입력한다 (선택)

예외 상황:
- 가격이 음수면 "가격은 0원 이상이어야 합니다"
- 재고가 음수면 "재고는 0개 이상이어야 합니다"
- 브랜드를 선택하지 않으면 "브랜드를 선택해주세요"
```

---

## 2. 브랜드 도메인

### US-B01: 브랜드 조회

```
As a 고객
I want 브랜드 정보를 보고 싶다
So that 신뢰할 수 있는 브랜드의 상품을 선택할 수 있다

인수 조건:
✓ 브랜드명과 설명이 표시된다
✓ 해당 브랜드의 상품 목록도 함께 보인다
✓ 브랜드 상품도 페이지네이션이 적용된다

예외 상황:
- 존재하지 않는 브랜드면 "브랜드를 찾을 수 없습니다"
- 삭제된 브랜드면 "운영 종료된 브랜드입니다"
```

### US-B02: 브랜드 등록 (관리자)

```
As a 시스템 관리자
I want 새로운 브랜드를 등록하고 싶다
So that 신규 브랜드의 입점을 지원할 수 있다

인수 조건:
✓ 브랜드명을 입력한다 (필수, 중복 불가)
✓ 브랜드 설명을 입력한다 (선택)

예외 상황:
- 같은 이름의 브랜드가 있으면 "이미 존재하는 브랜드입니다"
- 브랜드명이 비어있으면 "브랜드명을 입력해주세요"
```

---

## 3. 좋아요 도메인

### US-L01: 상품 좋아요 등록

```
As a 고객
I want 마음에 드는 상품에 좋아요를 표시하고 싶다
So that 나중에 다시 쉽게 찾을 수 있다

인수 조건:
✓ 하트 아이콘을 누르면 좋아요가 등록된다
✓ 같은 상품에 여러 번 좋아요를 눌러도 한 번만 등록된다 (멱등성)
✓ 좋아요 수가 1 증가한다
✓ 로그인한 고객만 사용할 수 있다

예외 상황:
- 이미 좋아요한 상품이면 에러 없이 성공 응답
- 로그인하지 않았으면 "로그인이 필요합니다"
- 존재하지 않는 상품이면 "상품을 찾을 수 없습니다"
```

### US-L02: 상품 좋아요 취소

```
As a 고객
I want 좋아요를 취소하고 싶다
So that 더 이상 관심 없는 상품을 관리할 수 있다

인수 조건:
✓ 채워진 하트 아이콘을 누르면 좋아요가 취소된다
✓ 이미 취소된 상품을 다시 취소해도 에러 없이 성공 응답 (멱등성)
✓ 좋아요 수가 1 감소한다

예외 상황:
- 좋아요하지 않은 상품이어도 에러 없이 성공 응답
```

### US-L03: 내가 좋아요한 상품 목록

```
As a 고객
I want 내가 좋아요한 상품 목록을 보고 싶다
So that 관심 상품을 한눈에 확인하고 구매를 결정할 수 있다

인수 조건:
✓ 최근 좋아요한 순서대로 정렬된다
✓ 페이지네이션이 적용된다 (20개씩)
✓ 각 상품의 현재 가격과 재고 상태가 표시된다

예외 상황:
- 좋아요한 상품이 없으면 "아직 좋아요한 상품이 없습니다"
- 좋아요한 상품이 삭제되었으면 목록에서 제외
```

---

## 4. 주문 도메인

### US-O01: 주문 생성

```
As a 고객
I want 여러 상품을 한 번에 주문하고 싶다
So that 원하는 상품들을 안전하게 구매할 수 있다

인수 조건:
✓ 여러 상품을 한 번에 주문할 수 있다
✓ 각 상품의 수량을 지정할 수 있다 (1개 이상)
✓ 총 주문 금액이 자동으로 계산된다
✓ 재고가 충분한지 확인한다
✓ 포인트가 충분한지 확인한다
✓ 모든 확인이 완료되면 주문이 생성된다

주문 성공 시:
✓ 각 상품의 재고가 주문 수량만큼 감소한다
✓ 고객의 포인트가 주문 금액만큼 차감된다
✓ 포인트 거래 내역에 "사용" 기록이 남는다
✓ 주문 상태는 "대기"로 시작한다

예외 상황:
- 재고가 부족하면 "상품명의 재고가 부족합니다 (현재 X개)"
- 포인트가 부족하면 "포인트가 부족합니다 (필요: X원, 보유: Y원)"
- 존재하지 않는 상품이 포함되면 "상품을 찾을 수 없습니다"
- 수량이 0개면 "수량은 1개 이상이어야 합니다"
```

### 중요: 주문의 원자성 (All or Nothing)

```
[시나리오]
1. 고객이 신발(50,000원) 1개, 티셔츠(30,000원) 2개 주문
2. 총 금액: 110,000원

[처리 순서]
Step 1: 신발 재고 확인 및 차감 (10개 → 9개)
Step 2: 티셔츠 재고 확인 및 차감 (5개 → 3개)
Step 3: 포인트 차감 (150,000원 → 40,000원)
Step 4: 주문 생성 (주문 #123)

[원자성 보장]
- 모든 Step이 성공하면 → 주문 완료
- 하나라도 실패하면 → 모든 Step 취소 (롤백)

[예시: Step 3에서 실패]
❌ 포인트 부족으로 실패
↓
✅ Step 1, 2에서 차감한 재고 원복
✅ 주문 생성 안 함
✅ 고객에게 "포인트가 부족합니다" 알림
```

### US-O02: 주문 조회

```
As a 고객
I want 내 주문 내역을 보고 싶다
So that 주문 상태를 확인하고 관리할 수 있다

인수 조건:
✓ 주문 일시, 상품 목록, 총 금액이 표시된다
✓ 주문 상태(대기/완료/취소)가 표시된다
✓ 최신 주문이 먼저 보인다
✓ 페이지네이션이 적용된다

예외 상황:
- 주문 내역이 없으면 "아직 주문 내역이 없습니다"
```

### US-O03: 주문 취소

```
As a 고객
I want 주문을 취소하고 싶다
So that 잘못 주문했거나 마음이 바뀌었을 때 대응할 수 있다

인수 조건
✓ 주문 상태가 "대기"일 때만 취소 가능
✓ 취소하면 다음이 모두 실행된다:
  - 주문 상태가 "취소"로 변경
  - 차감했던 재고가 원복
  - 사용했던 포인트가 환불
  - 포인트 거래 내역에 "환불" 기록

예외 상황
- 이미 배송 시작("완료")이면 "배송 시작 후에는 취소할 수 없습니다"
- 이미 취소된 주문이면 "이미 취소된 주문입니다"
- 다른 사람의 주문이면 "권한이 없습니다"
```

### 중요: 주문 취소의 보상 트랜잭션

```
[주문 생성 시]
재고 차감 → 포인트 차감 → 주문 생성

[주문 취소 시 (역순)]
포인트 환불 → 재고 복구 → 주문 상태 변경

[보상 트랜잭션 보장]
- 모든 복구 작업이 성공하거나 모두 실패
- 부분적으로 복구되는 일은 없음
```

---

## 🔒 비기능 요구사항

> **기능은 아니지만 시스템 품질에 영향을 주는 요구사항입니다.**

### 1. 성능 (Performance)

```
왜 중요한가?
- 고객이 "느리다"고 느끼면 이탈한다
- 특히 상품 목록, 주문 생성은 빠르게 처리되어야 함

측정 기준:
✓ 상품 목록 조회: 평균 200ms 이하
✓ 상품 상세 조회: 평균 100ms 이하
✓ 주문 생성: 평균 1초 이하
✓ 좋아요 등록/취소: 평균 100ms 이하
```

### 2. 데이터 정합성 (Data Integrity)

```
왜 중요한가?
- 재고가 음수가 되면 판매할 수 없는 상품을 판매하게 됨
- 포인트가 음수가 되면 고객에게 손해
- 주문과 결제가 따로 놀면 정산 문제 발생

보장해야 할 것:
✓ 재고는 절대 음수가 될 수 없다
✓ 포인트는 절대 음수가 될 수 없다
✓ 주문-재고-포인트는 항상 일치한다
✓ 동시에 여러 사람이 마지막 재고 1개를 주문해도 한 명만 성공
```

### 3. 동시성 제어 (Concurrency Control)

```
상황:
- 재고가 1개 남은 상품을 A, B 두 고객이 동시에 주문

문제:
- 둘 다 "재고 있음"을 확인
- 둘 다 주문 성공
- 재고가 -1개가 됨

해결:
✓ 재고 확인과 차감을 원자적으로 처리 (락 사용)
✓ 먼저 도착한 주문만 성공
✓ 늦게 도착한 주문은 "재고 부족" 응답
```

### 4. 멱등성 (Idempotency)

```
왜 중요한가?
- 네트워크 불안정으로 같은 요청이 여러 번 올 수 있음
- 고객이 실수로 버튼을 여러 번 누를 수 있음

보장해야 할 것:
✓ 같은 상품에 좋아요를 여러 번 눌러도 한 번만 등록
✓ 같은 상품의 좋아요를 여러 번 취소해도 에러 없이 성공
✓ 결과적으로 최종 상태가 같으면 여러 번 실행해도 안전
```

---

## 🚫 제약사항

### 비즈니스 규칙

| 제약사항 | 이유 |
|---|---|
| 재고는 0개 이상 | 음수 재고는 판매할 수 없는 상품을 의미 |
| 포인트는 0원 이상 | 음수 포인트는 빚을 의미 (정책상 불가) |
| 주문 수량은 1개 이상 | 0개 주문은 의미 없음 |
| 배송 시작 후 취소 불가 | 이미 배송된 상품은 물리적으로 취소 불가 |
| 좋아요는 로그인 필수 | 누가 좋아요했는지 알아야 목록 제공 가능 |

### 데이터 규칙

| 항목 | 규칙 | 예시 |
|---|---|---|
| 사용자 ID | 영문, 숫자 10자 이내 | "user123" |
| 상품 가격 | 0원 이상 | 50000 |
| 재고 수량 | 0개 이상 | 10 |
| 포인트 금액 | 0원 이상 | 150000 |

---

## 📊 유스케이스 우선순위

### P0 (핵심 기능 - 반드시 구현)

| 기능 | 이유 |
|---|---|
| 상품 목록 조회 | 고객이 상품을 볼 수 없으면 구매 불가 |
| 상품 상세 조회 | 상품 정보 없이 구매 결정 불가 |
| 좋아요 등록/취소 | 고객 만족도 핵심 기능 |
| 주문 생성 | 매출의 시작점 |
| 주문 조회 | 고객이 자신의 주문을 확인할 수 있어야 함 |

### P1 (중요 기능 - 빠른 시일 내 구현)

| 기능 | 이유 |
|---|---|
| 브랜드 조회 | 브랜드 별 상품 보기 |
| 주문 취소 | 고객 권리 보장 |
| 상품 등록/수정 | 관리자 기능 |
